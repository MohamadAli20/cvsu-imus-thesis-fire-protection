const axios = require('axios');

class FetchData{
    
    async getFireData(req, res) {
        try{
            /* Get date today */
            let currentDate = new Date();
            const year = currentDate.getFullYear();
            const month = (currentDate.getMonth() + 1 < 10) ? '0' + (currentDate.getMonth() + 1) : currentDate.getMonth() + 1;
            const day = (currentDate.getDate() < 10) ? '0' + currentDate.getDate() : currentDate.getDate();

            currentDate = `${year}-${month}-${day}`;

            /*This is just for testing, uncomment the above fetching process to fetch the firedata from FIRMS API*/
            // const fireData = 
            "country_id,latitude,longitude,brightness,scan,track,acq_date,acq_time,satellite,instrument,confidence,version,bright_t31,frp,daynight\n"
            +"PHL,16.89077,122.12851,324.12,1.97,1.37,2024-04-24,213,Terra,MODIS,60,6.1NRT,295.82,31.79,D\n"
            +"PHL,14.428707,120.947236,321.82,1.98,1.37,2024-04-24,213,Terra,MODIS,46,6.1NRT,292.93,28.92,D\n" /*Palico IV, Imus, Cavite*/
            +"PHL,14.430018,120.922288,321.82,1.98,1.37,2024-04-24,213,Terra,MODIS,46,6.1NRT,292.93,28.92,D\n" /*Carsadang Bago ll Imus Cavite*/
            +"PHL,14.364280,120.920745,324.39,1.73,1.29,2024-04-24,213,Terra,MODIS,76,6.1NRT,294.28,29.12,D\n" /*Malagasang II-B, Imus, Cavite*/
            +"PHL,14.383902,120.960883,319.01,1.72,1.29,2024-04-24,213,Terra,MODIS,68,6.1NRT,294.73,16.18,D\n"/*Building B, Ground Floor, Ayala Malls Vermosa, Daang Hari Road, Imus, Cavite*/
            +"PHL,18.06879,121.38731,316.65,1.65,1.26,2024-04-24,213,Terra,MODIS,63,6.1NRT,290.03,20.02,D\n"
            +"PHL,18.0719,121.37806,313.54,1.65,1.26,2024-04-24,213,Terra,MODIS,56,6.1NRT,289.74,14.53,D\n"
            +"PHL,12.57174,121.0396,320.98,1.96,1.37,2024-04-24,215,Terra,MODIS,61,6.1NRT,299.01,22.68,D\n"
            +"PHL,13.42029,120.49916,316.92,1.72,1.29,2024-04-24,215,Terra,MODIS,60,6.1NRT,298.7,15.78,D\n"
            +"PHL,13.8559,121.01409,314.4,1.85,1.33,2024-04-24,215,Terra,MODIS,11,6.1NRT,294.29,16.07,D\n"
            +"PHL,14.0094,120.9865,319.23,1.83,1.32,2024-04-24,215,Terra,MODIS,0,6.1NRT,299.49,22.62,D\n"
            +"PHL,14.16147,120.62891,316.49,1.71,1.28,2024-04-24,215,Terra,MODIS,54,6.1NRT,297.36,14.99,D\n"
            +"PHL,14.72691,121.26,333.98,1.86,1.33,2024-04-24,215,Terra,MODIS,85,6.1NRT,291.14,73.15,D\n"
            +"PHL,14.99048,120.22153,326.57,1.54,1.22,2024-04-24,215,Terra,MODIS,42,6.1NRT,304.67,22.89,D\n"
            +"PHL,16.23006,121.73747,311.14,1.9,1.35,2024-04-24,215,Terra,MODIS,42,6.1NRT,292.34,13.68,D\n"
            +"PHL,10.88825,123.42162,323.33,3.26,1.71,2024-04-24,217,Terra,MODIS,76,6.1NRT,296.65,52.81,D\n"
            +"PHL,10.88934,123.41653,326.42,3.26,1.71,2024-04-24,217,Terra,MODIS,80,6.1NRT,296.49,70.7,D\n"
            +"PHL,10.89327,123.39307,336.1,3.25,1.7,2024-04-24,217,Terra,MODIS,87,6.1NRT,296.45,142.68,D\n"
            +"PHL,10.89415,123.38794,332.22,3.25,1.7,2024-04-24,217,Terra,MODIS,85,6.1NRT,296.49,111.26,D\n"
            +"PHL,11.80163,120.01713,322.28,1.69,1.28,2024-04-24,217,Terra,MODIS,22,6.1NRT,296.61,22.7,D\n"
            +"PHL,12.13115,120.05038,329.48,1.68,1.27,2024-04-24,217,Terra,MODIS,75,6.1NRT,297.95,36.44,D\n"
            +"PHL,12.13355,120.03564,326.05,1.68,1.27,2024-04-24,217,Terra,MODIS,65,6.1NRT,298.64,30.24,D\n"
            +"PHL,7.26425,122.24527,319.66,2.26,1.46,2024-04-24,618,Aqua,MODIS,69,6.1NRT,296.47,23.46,D\n"
            +"PHL,7.26644,122.25038,319.3,2.26,1.46,2024-04-24,618,Aqua,MODIS,23,6.1NRT,296.18,20.14,D\n"
            +"PHL,9.81588,118.71632,325.99,1.35,1.15,2024-04-24,618,Aqua,MODIS,79,6.1NRT,300.83,14.03,D\n"
            +"PHL,10.79925,122.71586,310.79,2.8,1.6,2024-04-24,618,Aqua,MODIS,30,6.1NRT,296.87,24.65,D\n"
            +"PHL,14.73717,120.86945,323.85,2.3,1.47,2024-04-24,622,Aqua,MODIS,42,6.1NRT,301.2,45.21,D\n"
            +"PHL,15.96834,119.9397,340.18,2.04,1.39,2024-04-24,622,Aqua,MODIS,90,6.1NRT,300.18,82.08,D\n"
            +"PHL,16.5094,120.74043,308.52,2.82,1.6,2024-04-24,1306,Terra,MODIS,61,6.1NRT,284.16,42.06,N\n"
            +"PHL,16.51379,120.73524,311.99,2.82,1.6,2024-04-24,1306,Terra,MODIS,77,6.1NRT,284.07,53.91,N\n"
            +"PHL,16.50281,120.74675,307.84,1.66,1.27,2024-04-24,1832,Aqua,MODIS,73,6.1NRT,289.88,16.46,N\n"
            +"PHL,16.50538,120.7317,301.67,1.65,1.26,2024-04-24,1832,Aqua,MODIS,19,6.1NRT,289.92,9.26,N\n"
            +"PHL,16.51422,120.74704,310.88,1.66,1.27,2024-04-24,1832,Aqua,MODIS,81,6.1NRT,287.57,20.86,N\n"
            +"PHL,16.51678,120.732,308.62,1.65,1.26,2024-04-24,1832,Aqua,MODIS,73,6.1NRT,289.47,17.98,N\n"
            +"PHL,14.00202,120.99612,307.19,1.93,1.36,2024-04-24,1834,Aqua,MODIS,71,6.1NRT,294.19,15.49,N\n"
            +"PHL,16.50718,120.74998,325.53,4.05,1.87,2024-04-25,117,Terra,MODIS,68,6.1NRT,294.56,141.55,D\n"
            +"PHL,16.51361,120.75719,325.81,4.05,1.87,2024-04-25,117,Terra,MODIS,69,6.1NRT,294.29,150.34,D\n"
            +"PHL,16.51691,120.72318,318.37,4.08,1.87,2024-04-25,117,Terra,MODIS,66,6.1NRT,293.01,93.71,D\n"
            +"PHL,7.71505,125.20777,320.54,1.36,1.16,2024-04-25,120,Terra,MODIS,52,6.1NRT,299.83,15.64,D\n"
            +"PHL,8.05425,124.74947,322.49,1.48,1.2,2024-04-25,120,Terra,MODIS,57,6.1NRT,303.17,17.24,D\n"
            +"PHL,5.84062,125.38401,314.67,1.77,1.3,2024-04-25,521,Aqua,MODIS,22,6.1NRT,294.11,16.26,D\n"
            +"PHL,6.26996,125.5522,313.4,1.69,1.28,2024-04-25,521,Aqua,MODIS,51,6.1NRT,294.67,13.1,D\n"
            +"PHL,6.27072,125.5585,312.9,1.69,1.28,2024-04-25,521,Aqua,MODIS,37,6.1NRT,294.59,11.23,D\n"
            +"PHL,7.60185,125.30274,329.32,1.68,1.27,2024-04-25,521,Aqua,MODIS,80,6.1NRT,297.11,42.95,D\n"
            +"PHL,7.60303,125.31197,349.37,1.67,1.27,2024-04-25,521,Aqua,MODIS,95,6.1NRT,300.4,113.61,D\n"
            +"PHL,7.60409,125.31718,357.41,1.67,1.27,2024-04-25,521,Aqua,MODIS,98,6.1NRT,300.86,151.48,D\n"
            +"PHL,7.60528,125.32583,321.03,1.67,1.27,2024-04-25,521,Aqua,MODIS,52,6.1NRT,298.79,21.69,D\n"
            +"PHL,7.6701,125.22668,322.17,1.69,1.28,2024-04-25,521,Aqua,MODIS,67,6.1NRT,297.61,27.48,D\n"
            +"PHL,7.69659,125.24547,314.56,1.68,1.28,2024-04-25,521,Aqua,MODIS,13,6.1NRT,298.32,11.1,D\n"
            +"PHL,7.85552,125.59273,322.21,1.58,1.24,2024-04-25,521,Aqua,MODIS,73,6.1NRT,299.06,24.13,D\n"
            +"PHL,7.89208,124.82161,325.71,1.8,1.32,2024-04-25,521,Aqua,MODIS,40,6.1NRT,294.62,38.91,D\n"
            +"PHL,7.93193,125.65292,313.05,1.56,1.23,2024-04-25,521,Aqua,MODIS,29,6.1NRT,297.17,8.9,D\n"
            +"PHL,7.94529,125.64355,315.23,1.56,1.23,2024-04-25,521,Aqua,MODIS,59,6.1NRT,296.88,12.24,D\n"
            +"PHL,7.98581,124.96371,326.06,1.75,1.3,2024-04-25,521,Aqua,MODIS,79,6.1NRT,302.98,30.04,D\n"
            +"PHL,8.17149,124.97254,318.57,1.74,1.29,2024-04-25,521,Aqua,MODIS,59,6.1NRT,297.43,20.42,D\n"
            +"PHL,8.50276,124.38432,330.25,1.9,1.35,2024-04-25,521,Aqua,MODIS,83,6.1NRT,298.3,46.11,D\n"
            +"PHL,8.50561,124.40179,335.52,1.89,1.34,2024-04-25,521,Aqua,MODIS,87,6.1NRT,298.14,62.53,D\n"
            +"PHL,8.51459,124.38216,341.38,1.9,1.35,2024-04-25,521,Aqua,MODIS,91,6.1NRT,299.27,88.87,D\n"
            +"PHL,8.5174,124.39951,351.08,1.89,1.34,2024-04-25,521,Aqua,MODIS,96,6.1NRT,299.98,134.74,D\n"
            +"PHL,8.60482,125.45233,315.28,1.57,1.23,2024-04-25,521,Aqua,MODIS,64,6.1NRT,297.95,13.57,D\n"
            +"PHL,8.71605,125.42783,316.51,1.57,1.23,2024-04-25,521,Aqua,MODIS,68,6.1NRT,298.13,15.12,D\n"
            +"PHL,8.76365,125.63769,316,1.51,1.21,2024-04-25,521,Aqua,MODIS,67,6.1NRT,296.52,13.17,D\n"
            +"PHL,8.82677,125.10371,313.91,1.65,1.26,2024-04-25,521,Aqua,MODIS,37,6.1NRT,298.39,11.97,D\n"
            +"PHL,8.88096,125.37457,316.86,1.57,1.24,2024-04-25,521,Aqua,MODIS,69,6.1NRT,298.11,15.45,D\n"
            +"PHL,9.65041,122.6498,319.98,2.48,1.52,2024-04-25,521,Aqua,MODIS,46,6.1NRT,299.12,22.07,D\n"
            +"PHL,11.40278,125.05485,313.15,1.5,1.21,2024-04-25,521,Aqua,MODIS,48,6.1NRT,298.94,10.04,D\n"
            +"PHL,11.50402,125.04534,314.99,1.5,1.21,2024-04-25,521,Aqua,MODIS,50,6.1NRT,298.65,8.73,D\n"
            +"PHL,11.99917,124.88458,324.6,1.51,1.21,2024-04-25,523,Aqua,MODIS,77,6.1NRT,300.54,24.53,D\n"
            +"PHL,12.08229,124.89173,310.8,1.5,1.21,2024-04-25,523,Aqua,MODIS,23,6.1NRT,294.35,5.76,D\n"
            +"PHL,12.3424,123.47088,314.03,1.9,1.35,2024-04-25,523,Aqua,MODIS,59,6.1NRT,298.51,14.27,D\n"
            +"PHL,14.00668,120.9959,316.22,2.74,1.58,2024-04-25,523,Aqua,MODIS,0,6.1NRT,289.36,35.29,D\n"
            +"PHL,14.73845,120.88107,318.45,2.7,1.57,2024-04-25,523,Aqua,MODIS,33,6.1NRT,294.53,37.56,D\n"
            +"PHL,15.63902,121.0583,324.58,2.51,1.52,2024-04-25,523,Aqua,MODIS,59,6.1NRT,293.7,38.14,D\n"
            +"PHL,15.64404,121.06407,323.24,2.51,1.52,2024-04-25,523,Aqua,MODIS,66,6.1NRT,293.47,35.57,D\n"
            +"PHL,15.80087,120.83106,324.63,2.6,1.55,2024-04-25,523,Aqua,MODIS,74,6.1NRT,292.65,37.41,D\n"
            +"PHL,15.80791,120.82268,326.66,2.6,1.55,2024-04-25,523,Aqua,MODIS,72,6.1NRT,292.11,48.65,D\n"
            +"PHL,16.54833,121.10819,324.31,2.39,1.49,2024-04-25,523,Aqua,MODIS,72,6.1NRT,292.22,59.32,D\n"
            +"PHL,16.79175,121.43197,357.69,2.23,1.45,2024-04-25,523,Aqua,MODIS,75,6.1NRT,296.52,209.5,D\n"
            +"PHL,16.84363,121.20431,318.83,2.31,1.47,2024-04-25,523,Aqua,MODIS,62,6.1NRT,298.22,32.34,D\n"
            +"PHL,16.86421,121.39087,327.58,2.23,1.45,2024-04-25,523,Aqua,MODIS,78,6.1NRT,303.11,38.68,D\n"
            +"PHL,17.08965,120.82538,311.02,2.45,1.51,2024-04-25,523,Aqua,MODIS,35,6.1NRT,290.23,21.94,D\n"
            +"PHL,17.09333,120.83045,313.68,2.45,1.51,2024-04-25,523,Aqua,MODIS,46,6.1NRT,289.57,28.81,D\n"
            +"PHL,17.78438,121.29118,331.35,2.18,1.43,2024-04-25,523,Aqua,MODIS,79,6.1NRT,293.79,76.32,D\n"
            +"PHL,17.96255,121.4654,320.88,2.09,1.41,2024-04-25,523,Aqua,MODIS,69,6.1NRT,292.14,33.17,D\n"
            +"PHL,17.96268,121.18214,317.31,2.2,1.44,2024-04-25,523,Aqua,MODIS,44,6.1NRT,292.31,38.27,D\n"
            +"PHL,18.10718,121.3304,318.71,2.13,1.42,2024-04-25,525,Aqua,MODIS,44,6.1NRT,297.18,25,D\n"
            +"PHL,18.1123,121.34231,316.16,2.12,1.42,2024-04-25,525,Aqua,MODIS,20,6.1NRT,296.36,16.54,D\n";
            
            const { instrument, date, range } = req.params;
            // console.log(req.params);
            if(date !== currentDate){
                const response = await axios.get(`https://firms.modaps.eosdis.nasa.gov/api/country/csv/c1cfea789591c42cfe9feb7c959d5719/${instrument}/PHL/${range}/${date}`);
                res.json(response.data);
                // console.log(response.data);
                // console.log("Date selected: ", req.params); 
            }
            else if(date === currentDate){
                const response = await axios.get(`https://firms.modaps.eosdis.nasa.gov/api/country/csv/c1cfea789591c42cfe9feb7c959d5719/${instrument}/PHL/${range}`);
                res.json(response.data);
                // console.log(response.data);
                // console.log("Date today: ", req.params)
            }
            
            /*CVSU Imus coordinates*/
            // 14.428707, 120.947236

        }
        catch(error) {
            res.status(500).json({ error: error.message });
        }
      }
}

module.exports = new FetchData;